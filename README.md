# Реализация алгоритмов шифрования и расшифрования для криптосистемы HFE

## Описание проекта

Данный проект представляет собой реализацию криптосистемы **HFE (Hidden Field Equations)** на языке Python с поддержкой трех режимов работы:

1. **Обычная версия** - последовательное выполнение без распараллеливания
2. **CPU-параллельная версия** - использование multiprocessing для распараллеливания на CPU
3. **GPU-параллельная версия** - использование CUDA через PyTorch для распараллеливания на GPU

## Структура проекта

```
hw/
├── main.py                 # Главный файл для запуска программы
├── requirements.txt        # Зависимости проекта
├── README.md              # Документация проекта
├── tests/                  # Python-скрипты для тестирования
│   ├── README.md          # Документация по тестам
│   ├── run_all_tests.py   # Запуск всех тестов
│   ├── test_correctness.py # Тест корректности
│   ├── test_base.py       # Тест базовой версии
│   ├── test_cpu.py        # Тест CPU-версии
│   ├── test_gpu.py        # Тест GPU-версии
│   ├── test_all.py        # Комплексный тест
│   ├── test_performance.py # Тест производительности
│   └── test_utils.py      # Утилиты для тестов
└── src/                   # Исходный код модулей
    ├── __init__.py
    ├── logger_config.py   # Конфигурация логирования
    ├── field_operations.py # Операции над конечными полями GF(2^n)
    ├── hfe_base.py        # Базовая реализация HFE
    ├── hfe_cpu_parallel.py # CPU-параллельная реализация
    └── hfe_gpu_parallel.py # GPU-параллельная реализация
```

## Теоретическая основа

### Криптосистема HFE

**HFE (Hidden Field Equations)** - это криптографическая система с открытым ключом, основанная на многочленных уравнениях над конечными полями. Система была предложена Жаком Патарином в 1996 году.

#### Основные компоненты:

1. **Конечное поле GF(2^n)**: Работа с элементами поля размерности n
2. **HFE многочлен**: Специальный многочлен вида P(x) = Σ aᵢⱼ·x^(2ⁱ + 2ʲ)
3. **Аффинные преобразования**: Два секретных аффинных преобразования S и T

#### Алгоритм шифрования:

```
Открытый текст → S (аффинное преобразование) → HFE многочлен → T (аффинное преобразование) → Шифротекст
```

#### Алгоритм расшифрования:

```
Шифротекст → T⁻¹ → Решение HFE уравнения → S⁻¹ → Открытый текст
```

## Установка и запуск

### Требования

- Python 3.7+
- NumPy
- PyTorch (для GPU-параллелизации, опционально)

### Установка зависимостей

```bash
pip install -r requirements.txt
```

**Примечание**: Для GPU-параллелизации требуется:
- NVIDIA GPU с поддержкой CUDA
- PyTorch с поддержкой CUDA (устанавливается автоматически при наличии CUDA или вручную: `pip install torch`)

**Если возникают проблемы с CUDA**, проверьте доступность CUDA:
```bash
python3 -c "import torch; print(torch.cuda.is_available())"
```

### Запуск программы

#### Базовый запуск (все режимы):

```bash
python main.py
```

#### Запуск конкретного режима:

```bash
# Только обычная версия
python main.py --mode base

# Только CPU-параллельная версия
python main.py --mode cpu

# Только GPU-параллельная версия
python main.py --mode gpu

# Все режимы (по умолчанию)
python main.py --mode all
```

#### Дополнительные параметры:

```bash
# Изменение размера тестовых данных
python main.py --data-size 2048

# Изменение размерности поля
python main.py --n 8

# Изменение степени HFE многочлена
python main.py --d 3

# Указание количества процессов для CPU-параллелизации
python main.py --mode cpu --num-processes 4

# Изменение уровня логирования
python main.py --log-level DEBUG

# Сохранение логов в файл
python main.py --log-file logs/hfe.log
```

## Тестирование

Проект включает набор Python-скриптов для тестирования различных аспектов реализации:

```bash
# Запуск всех тестов
python3 tests/run_all_tests.py

# Отдельные тесты
python3 tests/test_correctness.py    # Тест корректности шифрования/расшифрования
python3 tests/test_base.py           # Тест базовой версии
python3 tests/test_cpu.py            # Тест CPU-параллельной версии
python3 tests/test_gpu.py            # Тест GPU-параллельной версии
python3 tests/test_all.py            # Комплексный тест всех версий
python3 tests/test_performance.py    # Тест производительности
```

Подробная документация по тестам находится в `tests/README.md`.

## Детальное описание реализации

### 1. Модуль `field_operations.py`

Реализует операции над конечным полем GF(2^n):

- **Сложение**: Простое XOR-сложение
- **Умножение**: Умножение с приведением по модулю неприводимого многочлена
- **Возведение в степень**: Эффективное возведение в степень
- **Преобразования**: Вектор ↔ элемент поля

**Особенности**:
- Для GF(2^8) используется неприводимый многочлен x⁸ + x⁴ + x³ + x + 1 (0x11B)
- Операции оптимизированы для работы с целыми числами

### 2. Модуль `hfe_base.py`

Базовая реализация HFE без распараллеливания:

**Ключевые методы**:
- `_generate_keys()`: Генерация секретных ключей (матрицы S₁, S₀, T₁, T₀)
- `_hfe_polynomial()`: Вычисление значения HFE многочлена
- `_affine_transform()`: Применение аффинного преобразования
- `_solve_hfe()`: Решение HFE уравнения (перебором)
- `encrypt_block()` / `decrypt_block()`: Шифрование/расшифрование блоков данных

**Особенности**:
- Генерация обратимых матриц для аффинных преобразований
- Вычисление обратных матриц методом Гаусса-Жордана
- Последовательная обработка байтов

### 3. Модуль `hfe_cpu_parallel.py`

CPU-параллельная реализация с использованием `multiprocessing`:

**Принцип работы**:
1. Данные разбиваются на chunks (части)
2. Каждый chunk обрабатывается в отдельном процессе
3. Результаты объединяются

**Оптимизации**:
- Использование всех доступных ядер CPU
- Минимизация накладных расходов на создание процессов
- Эффективное разделение данных

**Особенности**:
- Настраиваемое количество процессов
- Автоматическое определение количества ядер
- Параллельная обработка независимых блоков данных

### 4. Модуль `hfe_gpu_parallel.py`

GPU-параллельная реализация с использованием PyTorch:

**Принцип работы**:
1. Данные преобразуются в тензоры PyTorch и копируются на GPU
2. Операции выполняются параллельно с использованием пакетной обработки
3. Результаты копируются обратно на CPU

**Основные методы**:
- `GF2nGPU`: Класс для работы с конечным полем GF(2^n) на GPU
- `_affine_transform_gpu`: Параллельное аффинное преобразование
- `_hfe_polynomial_gpu`: Параллельное вычисление HFE многочлена
- `_solve_hfe_gpu`: Параллельное решение HFE уравнений
- `encrypt_batch` / `decrypt_batch`: Пакетное шифрование/расшифрование

**Примененные оптимизации**:

1. **Пакетная обработка (Batch Processing)**:
   - Данные обрабатываются батчами для эффективного использования GPU
   - Настраиваемый размер батча (по умолчанию 1024)
   - Минимизация накладных расходов на передачу данных

2. **Векторизованные операции PyTorch**:
   - Использование встроенных операций PyTorch для параллельных вычислений
   - Эффективная работа с тензорами на GPU
   - Оптимизированные матричные операции

3. **Оптимизированная арифметика GF(2^n)**:
   - Эффективное умножение с приведением по модулю неприводимого многочлена
   - Быстрое возведение в степень методом быстрого возведения
   - Пакетная обработка операций над полем

4. **Гибридный подход**:
   - Простые операции выполняются на GPU
   - Сложные операции (решение уравнений) могут использовать CPU при необходимости
   - Автоматический выбор оптимальной стратегии

**Особенности**:
- Пакетная обработка больших объемов данных
- Эффективное использование памяти GPU через тензоры PyTorch
- Гибридный подход для сложных операций (GPU + CPU)
- Автоматическое определение доступности CUDA

### 5. Модуль `logger_config.py`

Система логирования с поддержкой разных уровней:

- **DEBUG**: Детальная отладочная информация
- **INFO**: Основная информация о работе
- **WARNING**: Предупреждения
- **ERROR**: Ошибки

Поддерживает вывод в консоль и в файл.

## Примеры использования

### Пример 1: Базовое шифрование

```python
from src.hfe_base import HFEBase

# Создание экземпляра
hfe = HFEBase(n=8, d=3, seed=42)

# Шифрование
data = b"Hello, World!"
encrypted = hfe.encrypt_block(data)

# Расшифрование
decrypted = hfe.decrypt_block(encrypted)
assert data == decrypted
```

### Пример 2: CPU-параллельное шифрование

```python
from src.hfe_cpu_parallel import HFECPUParallel

# Создание экземпляра с 4 процессами
hfe = HFECPUParallel(n=8, d=3, seed=42, num_processes=4)

# Шифрование большого объема данных
data = b"x" * 10000  # 10 KB данных
encrypted = hfe.encrypt_block(data)
decrypted = hfe.decrypt_block(encrypted)
```

### Пример 3: GPU-параллельное шифрование

```python
from src.hfe_gpu_parallel import HFEGPUParallel

# Создание экземпляра
hfe = HFEGPUParallel(n=8, d=3, seed=42)

# Шифрование большого объема данных
data = b"x" * 1000000  # 1 MB данных
encrypted = hfe.encrypt_block(data)
decrypted = hfe.decrypt_block(encrypted)
```

## Логирование

Программа поддерживает несколько уровней логирования:

- **DEBUG**: Детальная информация для отладки
- **INFO**: Основная информация о работе (по умолчанию)
- **WARNING**: Предупреждения
- **ERROR**: Только ошибки

Примеры:

```bash
# DEBUG уровень
python main.py --log-level DEBUG

# Сохранение в файл
python main.py --log-file logs/hfe.log --log-level INFO
```